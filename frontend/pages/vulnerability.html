<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RakshaNetra | Vulnerability Scanner</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600;700&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#0dccf2",
            bgDark: "#101f22",
            surface: "#111718",
            borderDark: "#283639",
          },
          fontFamily: {
            display: ["Space Grotesk", "sans-serif"],
          },
        },
      },
    };
  </script>

  <style>
    body { font-family: "Space Grotesk", sans-serif; }
  </style>
</head>

<body class="bg-bgDark text-white">

<main class="ml-64 p-10 max-w-4xl">

  <div class="text-center mb-10">
    <h1 class="text-4xl font-black mb-3">Vulnerability Scanner</h1>
    <p class="text-slate-400">
      Passive security analysis for websites (safe & legal).
    </p>
  </div>

  <div class="bg-surface border border-borderDark rounded-xl p-6 space-y-4">

    <input
      id="targetUrl"
      type="text"
      placeholder="https://example.com"
      class="w-full bg-bgDark border border-borderDark rounded-lg px-4 py-3 outline-none focus:border-primary"
    />

    <button
      onclick="scanWebsite()"
      class="w-full px-6 py-3 bg-primary text-bgDark font-bold rounded-lg"
    >
      ğŸ” Start Vulnerability Scan
    </button>

    <div id="scanResult" class="hidden mt-4 p-4 rounded-lg text-sm"></div>
  </div>

</main>

<script>
async function scanWebsite() {
    const url = document.getElementById("targetUrl").value.trim();
    const resultDiv = document.getElementById("scanResult");

    if (!url) {
        alert("Please enter a website URL");
        return;
    }

    resultDiv.classList.remove("hidden");
    resultDiv.className = "mt-4 p-4 rounded-lg bg-gray-800";
    resultDiv.innerHTML = "ğŸ” Scanning website...";

    try {
        const response = await fetch(
            "http://127.0.0.1:5000/api/scan-vulnerability",
            {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ url })
            }
        );

        const data = await response.json();
        const report = data.report;

        let color = "bg-green-900";
        if (report.risk === "MEDIUM") color = "bg-yellow-900";
        if (report.risk === "HIGH") color = "bg-red-900";

        let issues = "<b>No vulnerabilities found âœ…</b>";
        if (report.vulnerabilities.length) {
            issues = report.vulnerabilities.map(v => `
              â— <b>${v.name}</b> (${v.severity})<br>
              Impact: ${v.impact}<br>
              Fix: ${v.fix}<br><br>
            `).join("");
        }

        resultDiv.className = `mt-4 p-4 rounded-lg text-sm ${color}`;
        resultDiv.innerHTML = `
          ğŸŒ <b>URL:</b> ${report.url}<br>
          ğŸ›¡ <b>Risk:</b> ${report.risk}<br>
          ğŸ“Š <b>Score:</b> ${report.score}/100<br><br>
          ${issues}
          <button onclick="downloadPDF('${data.pdf}')"
            class="mt-4 px-4 py-2 bg-primary text-bgDark font-bold rounded">
            ğŸ“„ Download PDF Report
          </button>
        `;
    } catch (err) {
        resultDiv.className = "mt-4 p-4 rounded-lg bg-red-900";
        resultDiv.innerHTML = "âŒ Backend not reachable";
    }
}

function downloadPDF(file) {
    window.open(
      `http://127.0.0.1:5000/api/download-report?file=${file}`,
      "_blank"
    );
}
</script>

</body>
</html>
